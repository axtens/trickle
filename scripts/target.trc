REM SET VERIFY STATE IF VERIFY ON COMMANDLINE
IF CMD VERIFY
VERIFY ON
ENDIF
USERBREAK ON
INVOKE "A:\SIGNON.EXE"

REM PDQ TARGET FILE
REM VERSION 1.0
VAR VERSION 1
VAR UPDATE 1
NOTIFY "TARGET.TCL V&'VAR VERSION'.&'VAR UPDATE'"

CLS
VAR SLAVE C:\
REM RECEIVE FILES
INVOKE "A:\PDQ.EXE" " /R /B"
REM When this statement is reached, the assumption is that PDQ has
REM  copied all of the files in a distribution set over to the 
REM  target machine. Further, the source TCL has created and copied
REM  over a series of .FLG files indicating configuration options.
REM  These .FLG files will be one of more of the following:
REM        CGA.FLG - target system has CGA screen
REM        EGA.FLG - target system has EGA screen
REM        VGA.FLG - target system has VGA screen
REM        MONO.FLG - target machine has MONO screen and driver
REM        EGAMON.FLG - target machine has MONO screen and EGA driver
REM        CLOCK.FLG - target machine uses CLOCK.COM for clock control
REM        RAMCLK.FLG - target machine uses RAMCLK.COM for clock control

VAR BEEP1 1600
VAR BEEP2 800
VAR BEEP3 400
VAR BEEP4 800
VAR BEEPDUR 35

VAR WAITER 9
LABEL WAITERLOOP1
BEEP "&'VAR BEEP1'" "&'VAR BEEPDUR'"
BEEP "&'VAR BEEP2'" "&'VAR BEEPDUR'"
BEEP "&'VAR BEEP3'" "&'VAR BEEPDUR'"
BEEP "&'VAR BEEP4'" "&'VAR BEEPDUR'"
WAIT 125
DECVAR WAITER
IF VAR WAITER GT 0
GOTO WAITERLOOP1
ENDIF
EXISTS "C:\CGA.FLG"
IF SYS IO EQ 0
DELETE C:\CGA.FLG
VAR MONITORNAME CGA
GOTO TRANSLATEMENU
ENDIF

EXISTS "C:\EGA.FLG"
IF SYS IO EQ 0
DELETE C:\EGA.FLG
VAR MONITORNAME CGA
GOTO TRANSLATEMENU
ENDIF

EXISTS "C:\VGA.FLG"
IF SYS IO EQ 0
DELETE C:\VGA.FLG
VAR MONITORNAME CGA
GOTO TRANSLATEMENU
ENDIF

EXISTS "C:\MONO.FLG"
IF SYS IO EQ 0
DELETE C:\MONO.FLG
VAR MONITORNAME MONO
GOTO TRANSLATEMENU
ENDIF

EXISTS "C:\EGAMON.FLG"
IF SYS IO EQ 0
DELETE C:\EGAMON.FLG
VAR MONITORNAME EGAMON
GOTO TRANSLATEMENU
ENDIF

LABEL TRANSLATEMENU
CHDIR C:\MENU
INVOKE "MAKEMM.EXE" "MENU &'VAR MONITORNAME'"

EXISTS C:\CLOCK.FLG
IF SYS IO EQ 0
DELETE C:\CLOCK.FLG
GOTO SETUPCLOCK
ENDIF

EXISTS C:\RAMCLK.FLG
IF SYS IO EQ 0
DELETE C:\RAMCLK.FLG
GOTO SETUPRAMCLK
ENDIF

NOTIFY "NO FLAG FILES DEFINING THE CLOCK CONTROL PROGRAM WERE FOUND"
GOTO ENDCLOCKS

LABEL SETUPCLOCK
SHELL "FOR %F IN (???CLK.COM SETTIME.BAT) DO DEL %F"
SHELL "C:\CLOCK.COM/I"
GOTO ENDCLOCKS

LABEL SETUPRAMCLK
SHELL "DEL C:\CLOCK.*"
SHELL "TIME"
SHELL "DATE"
SHELL "C:\SETCLK.COM"
GOTO ENDCLOCKS

LABEL ENDCLOCKS

EXISTS "C:\DMDRVR.BIN"
IF SYS IO EQ 0
APPEND "C:\CONFIG.SYS" DEVICE=C:\DMDRVR.BIN
ENDIF
EXISTS "C:\MULTIVOL.SYS"
IF SYS IO EQ 0
APPEND "C:\CONFIG.SYS" DEVICE=C:\MULTIVOL.SYS
ENDIF

SHELL "COPY C:\AUTOEXEC.BAT C:\AUTOEXEC.SAV"
SHELL "COPY C:\CONFIG.SYS C:\CONFIG.SAV"
SHELL "C:\UTILS\ATTR +R C:\*.SAV"
SHELL "C:\UTILS\ATTR +R C:\DOS\*.*"

EXISTS "C:\DMDRVR.BIN"
IF SYS IO EQ 0
SHELL "C:\UTILS\ATTR +R C:\DMDRVR.BIN"
ENDIF

EXISTS C:\MULTIVOL.SYS
IF SYS IO EQ 0
SHELL "C:\UTILS\ATTR +R C:\MULTIVOL.SYS"
ENDIF

SHELL "C:\UTILS\ATTR +R C:\COMMAND.COM"

VAR BEEP1 400
VAR BEEP2 800
VAR BEEP3 1200
VAR BEEP4 1600
VAR BEEPDUR 15

VAR WAITER 4
LABEL WAITERLOOP
BEEP "&'VAR BEEP1'" "&'VAR BEEPDUR'"
BEEP "&'VAR BEEP2'" "&'VAR BEEPDUR'"
BEEP "&'VAR BEEP3'" "&'VAR BEEPDUR'"
BEEP "&'VAR BEEP4'" "&'VAR BEEPDUR'"
WAIT 125
DECVAR WAITER
IF VAR WAITER GT 0
GOTO WAITERLOOP
ENDIF

CLS
INVOKE "c:\utils\SIGNON.EXE"
NOTIFY
NOTIFY "SYSTEM TRANSFER IS COMPLETE"
NOTIFY
NOTIFY "TAKE PDQ DISK FROM DRIVE A: NOW"
NOTIFY
PAUSE "TARGET COMPUTER WILL NOW REBOOT. PRESS ANY KEY"
REBOOT
HALT

